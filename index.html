<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Leave a Review</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 2rem auto;
      padding: 1rem;
    }
    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 1rem;
    }
    label.tag {
      background: #f0f0f0;
      padding: 6px 10px;
      border-radius: 20px;
      cursor: pointer;
    }
    input[type="checkbox"] {
      display: none;
    }
    input[type="checkbox"]:checked + span {
      background-color: #007bff;
      color: white;
    }
  </style>
</head>
<body>
  <h2>Leave a Review</h2>

  <form id="review-form">
    <label>Star Rating (1â€“5):</label><br />
    <input type="number" name="stars" min="1" max="5" required /><br /><br />

    <label><strong>Tag what they did well:</strong></label>
    <div class="tag-list">
      <label class="tag"><input type="checkbox" name="goodTags" value="Fast Shipping" /><span>Fast Shipping</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Secure Packaging" /><span>Secure Packaging</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Responsive" /><span>Responsive</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Informative" /><span>Informative</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Free Returns" /><span>Free Returns</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Item as Described" /><span>Item as Described</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Great Communication" /><span>Great Communication</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Trustworthy" /><span>Trustworthy</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Fair Pricing" /><span>Fair Pricing</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Repeat Buyer/Seller" /><span>Repeat Buyer/Seller</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Accurate Photos" /><span>Accurate Photos</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Smooth Transaction" /><span>Smooth Transaction</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Excellent Condition" /><span>Excellent Condition</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Highly Recommended" /><span>Highly Recommended</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Quick Response" /><span>Quick Response</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Great Deals" /><span>Great Deals</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Easy to Work With" /><span>Easy to Work With</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="Flexible" /><span>Flexible</span></label>
      <label class="tag"><input type="checkbox" name="goodTags" value="No Issues" /><span>No Issues</span></label>
    </div>

    <label><strong>Tag what they did not do well:</strong></label>
    <div class="tag-list">
      <label class="tag"><input type="checkbox" name="badTags" value="Poor Communication" /><span>Poor Communication</span></label>
      <label class="tag"><input type="checkbox" name="badTags" value="Misleading Description" /><span>Misleading Description</span></label>
      <label class="tag"><input type="checkbox" name="badTags" value="Damaged Item" /><span>Damaged Item</span></label>
      <label class="tag"><input type="checkbox" name="badTags" value="Inaccurate Photos" /><span>Inaccurate Photos</span></label>
      <label class="tag"><input type="checkbox" name="badTags" value="Poor Packaging" /><span>Poor Packaging</span></label>
      <label class="tag"><input type="checkbox" name="badTags" value="Not as Advertised" /><span>Not as Advertised</span></label>
      <label class="tag"><input type="checkbox" name="badTags" value="Delayed Payment" /><span>Delayed Payment</span></label>
      <label class="tag"><input type="checkbox" name="badTags" value="Hidden Issues" /><span>Hidden Issues</span></label>
    </div>

    <label>Additional Comments:</label><br />
    <textarea name="text" rows="4" cols="40"></textarea><br /><br />

    <button type="submit">Submit Review</button>
  </form>

  <script>
    const inviteID = new URLSearchParams(window.location.search).get("invite");

    document.getElementById("review-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const stars = form.stars.value;
      const text = form.text.value;

      // Get selected good and bad tags
      const goodTags = Array.from(form.querySelectorAll('input[name="goodTags"]:checked'))
                            .map(checkbox => checkbox.value);
      const badTags = Array.from(form.querySelectorAll('input[name="badTags"]:checked'))
                            .map(checkbox => checkbox.value);

      const res = await fetch("https://us-central1-YOUR_PROJECT.cloudfunctions.net/submitAnonymousReview", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ inviteID, stars, text, goodTags, badTags })
      });

      if (res.ok) {
        alert("Thanks! Your review was submitted.");
        form.reset();
      } else {
        const err = await res.text();
        alert("Error: " + err);
      }
    });
  </script>
</body>
</html>
